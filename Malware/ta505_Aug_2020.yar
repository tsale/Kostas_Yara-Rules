/*
    This yara rule detects some versions of the TA505 packed DLL downloader binaries in the 1st stage of infection.
    Thanks to the latest version of yara, I was able to use pe.exports(/regular_expresion/) to find binaries from
    older campaigns. The hash that contributed the most to this rule was taken from the campaign in August 12, 2020.

*/

import "pe"

rule boost_thread1 : TA505{
   meta:
      description = "FileName boost_thread1.bin"
      author = "Kostas Tsialemis - @Kostastsale"
      reference = "https://app.any.run/tasks/a53023af-232e-4a76-addc-65ef6dd8f1fa"
      date = "2020-08-13"
      SHA256 = "026e25a18dae7bae363c4cba43b129164e0b2f21ada7b471a0c6a3238b7c1057"
   strings:
      $s1 = "Strim.dll" fullword ascii
      $s2 = "https://sectigo.com/CPS0" fullword ascii
      $s3 = "Test menu text" fullword wide
      $s4 = "Mipher.dll" fullword ascii
      $s5 = "y9Ge!RS" fullword ascii
      $s6 = "Everything Wow" fullword ascii
      $s7 = "modules.dll" fullword ascii
      $s8 = "initTest" fullword ascii
      $s9 = "msi.dll" fullword ascii
   condition:
      uint16(0) == 0x5a4d and filesize < 800KB and
       ( pe.imphash() == "e96d44d6507ae73b2bbe6e0bac62b856" or ( pe.exports(/[Ii]nit/) or pe.exports(/[Tt]est/) ) or 3 of them )
}